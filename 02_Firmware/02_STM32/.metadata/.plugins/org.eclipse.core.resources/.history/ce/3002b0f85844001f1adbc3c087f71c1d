/*
 * tasksFunctions.c
 *
 *  Created on: Jul 13, 2024
 *      Author: dbank
 */


#include "tasksFunctions.h"
#include "comunicationProtocol.h"
#include "comunicationStructures.h"
#include "comunication_calculate_checksum.h"
#include "FreeRTOS.h"
#include "queue.h"
#include "task.h"

TaskHandle_t taskHandle_esp32IntrrruptRequest = NULL;

void esp32IntrrruptRequestCallback(void *pNothing){

	uint32_t taskNotifierVal;
	while(1){
		xTaskNotifyWait(0x0, 0xffff, &taskNotifierVal, portMAX_DELAY);

		printf("task\r\n");
		vTaskDelay(pdMS_TO_TICKS(1000));
	};
}




void initTaskFunctions(void){
	printf("Radio main firmware version: %.2f\r\n", FW_VERSION);

	configASSERT(xTaskCreate(esp32IntrrruptRequestCallback, "esp32IntReq", 3*128, NULL, tskIDLE_PRIORITY, &taskHandle_esp32IntrrruptRequest));
}



#define I2C_SLAVE_TRANSMIT_REQUEST_STARTED		GPIO_PIN_RESET
#define I2C_SLAVE_TRANSMIT_REQUEST_STOPPED		GPIO_PIN_SET
void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)
{
  //static bool esp32i2cRequestState;
	GPIO_PinState state = 	HAL_GPIO_ReadPin(esp32i2cInterruptReqest_GPIO_Port, esp32i2cInterruptReqest_Pin);
	switch(state){
  	  case I2C_SLAVE_TRANSMIT_REQUEST_STARTED:
  		printf("started\r\n");
  		break;
  	  case I2C_SLAVE_TRANSMIT_REQUEST_STOPPED:
  		printf("halt\r\n");

  }

  /* NOTE: This function Should not be modified, when the callback is needed,
           the HAL_GPIO_EXTI_Callback could be implemented in the user file
   */
}
